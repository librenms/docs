<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="LibreNMS">
    <link rel="canonical" href="https://www.librenms.org/docs/Installation/Installation-CentOS-6-Apache-Nginx/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Installation CentOS 6 Apache Nginx - LibreNMS Docs</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../librenms.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "On the DB Server", url: "#on-the-db-server", children: [
          ]},
          {title: "On the NMS", url: "#on-the-nms", children: [
          ]},
          {title: "Configure SNMPD on localhost", url: "#configure-snmpd-on-localhost", children: [
          ]},
          {title: "Adding the librenms-user for Apache", url: "#adding-the-librenms-user-for-apache", children: [
          ]},
          {title: "Adding the librenms-user for Nginx", url: "#adding-the-librenms-user-for-nginx", children: [
          ]},
          {title: "Using HTTPd (Apache2)", url: "#using-httpd-apache2", children: [
          ]},
          {title: "Using Nginx and PHP-FPM", url: "#using-nginx-and-php-fpm", children: [
          ]},
          {title: "Cloning", url: "#cloning", children: [
          ]},
          {title: "Prepare the Web Interface", url: "#prepare-the-web-interface", children: [
          ]},
          {title: "Start the web-server:", url: "#start-the-web-server", children: [
          ]},
          {title: "Web Installer", url: "#web-installer", children: [
          ]},
          {title: "Manual Install", url: "#manual-install", children: [
          ]},
          {title: "Validate your install", url: "#validate-your-install", children: [
          ]},
          {title: "Add localhost", url: "#add-localhost", children: [
          ]},
          {title: "Create cronjob", url: "#create-cronjob", children: [
          ]},
          {title: "Copy logrotate config", url: "#copy-logrotate-config", children: [
          ]},
          {title: "Daily Updates", url: "#daily-updates", children: [
          ]},
          {title: "Install complete", url: "#install-complete", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-79149977-2', 'docs.librenms.org');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
    
      <div class="source-links">
      
          <span class="label label-primary"><a href="https://github.com/librenms/librenms//edit/master/doc/Installation/Installation-CentOS-6-Apache-Nginx.md" target="_blank" style="color:#ffffff"><i class="fa fa-pencil"></i> Edit on GitHub</a></span>
      
      </div>
    

    <blockquote>
<p>NOTE: These instructions assume you are the <strong>root</strong> user.  If you are not, prepend <code>sudo</code> to the shell commands (the ones that aren't at <code>mysql&gt;</code> prompts) or temporarily become a user with root privileges with <code>sudo -s</code> or <code>sudo -i</code>.</p>
</blockquote>
<p><strong>Please note the minimum supported PHP version is 5.6.4</strong></p>
<h3 id="on-the-db-server">On the DB Server</h3>
<p>This host is where the MySQL database runs.  It could be the same machine as your network management server (this is the most common initial deployment scenario).</p>
<blockquote>
<p>** Whilst we are working on ensuring LibreNMS is compatible with MySQL strict mode, for now, please disable this after mysql is installed.</p>
</blockquote>
<p>You are free to choose between using MySQL or MariaDB:</p>
<p><strong>MySQL</strong></p>
<pre><code class="bash">yum install net-snmp mysql-server mysql-client
chkconfig mysqld on
service mysqld start
</code></pre>

<p><strong>MariaDB</strong></p>
<pre><code class="bash">yum install net-snmp mariadb-server mariadb-client
chkconfig mariadb on
service mariadb start
</code></pre>

<p>Now continue with the installation:</p>
<pre><code class="bash">chkconfig snmpd on
service snmpd start
mysql_secure_installation
mysql -uroot -p
</code></pre>

<p>Enter the MySQL/MariaDB root password to enter the command-line interface.</p>
<p>Create database.</p>
<pre><code class="sql">CREATE DATABASE librenms CHARACTER SET utf8 COLLATE utf8_unicode_ci;
CREATE USER 'librenms'@'localhost' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON librenms.* TO 'librenms'@'localhost';
FLUSH PRIVILEGES;
exit
</code></pre>

<p>Replace <code>&lt;ip&gt;</code> above with the IP of the server running LibreNMS.  If your database is on the same server as LibreNMS, use <code>localhost</code> as the IP address.</p>
<p>Edit the mysql/mariadb configuration file:</p>
<pre><code class="bash">vim /etc/my.cnf
</code></pre>

<p>Add the following line:</p>
<pre><code>innodb_file_per_table=1
</code></pre>
<p>If you are deploying a separate database server, you also need to specify the <code>bind-address</code>.  If your MySQL database resides on the same server as LibreNMS, you should skip this step.</p>
<pre><code>bind-address = &lt;ip&gt;
</code></pre>
<p>If you see a line that starts <code>sql-mode</code> then change this to <code>sql-mode=""</code>.</p>
<p>Save, and restart MySQL/MariaDB to apply your changes:</p>
<pre><code>service mysqld restart
</code></pre>
<p>or</p>
<pre><code>service mariadb restart
</code></pre>
<h3 id="on-the-nms">On the NMS</h3>
<p>Install necessary software.  The packages listed below are an all-inclusive list of packages that were necessary on a clean install of CentOS 6.x.  It also requires the EPEL repository. Net_IPv6 is required even if your network environment does not support IPv6.</p>
<p>Note if not using HTTPd (Apache): RHEL requires <code>httpd</code> to be installed regardless of of <code>nginx</code>'s (or any other web-server's) presence.</p>
<pre><code class="bash">    yum install epel-release
    yum install php php-cli php-gd php-mysql php-snmp php-pear php-curl httpd net-snmp graphviz graphviz-php mysql ImageMagick jwhois nmap mtr rrdtool MySQL-python net-snmp-utils vixie-cron php-mcrypt fping git
    pear install Net_IPv4-1.3.4
    pear install Net_IPv6-1.2.2b2
</code></pre>

<h3 id="configure-snmpd-on-localhost">Configure SNMPD on localhost</h3>
<p>Edit <code>/etc/snmp/snmpd.conf</code> to enable self-polling.  An absolute minimal config for snmpd is:</p>
<pre><code>rocommunity public 127.0.0.1
</code></pre>
<p>You may either edit the default configuration file to your liking, or backup the default config file and replace it entirely with your own. To apply your changes, run <code>service snmpd restart</code> for Centos 6.x. If you have deployed a separate database server, you will likely want to configure snmpd on that host as well.</p>
<h3 id="adding-the-librenms-user-for-apache">Adding the librenms-user for Apache</h3>
<pre><code class="bash">    useradd librenms -d /opt/librenms -M -r
    usermod -a -G librenms apache
</code></pre>

<h3 id="adding-the-librenms-user-for-nginx">Adding the librenms-user for Nginx</h3>
<pre><code class="bash">    useradd librenms -d /opt/librenms -M -r
    usermod -a -G librenms nginx
</code></pre>

<h3 id="using-httpd-apache2">Using HTTPd (Apache2)</h3>
<p>Set <code>httpd</code> to start on system boot.</p>
<pre><code class="bash">chkconfig --levels 235 httpd on
</code></pre>

<p>In <code>/etc/php.ini</code>, ensure <code>date.timezone</code> is set to your preferred time zone.  See http://php.net/manual/en/timezones.php for a list of supported timezones.  Valid
examples are: "America/New York", "Australia/Brisbane", "Etc/UTC".
Please also ensure that <code>allow_url_fopen</code> is enabled. Other functions needed for LibreNMS include <code>exec,passthru,shell_exec,escapeshellarg,escapeshellcmd,proc_close,proc_open,popen</code>.</p>
<p>Next, add the following to <code>/etc/httpd/conf.d/librenms.conf</code></p>
<p>If you are running Apache below version 2.2.18:</p>
<pre><code class="apache">&lt;VirtualHost *:80&gt;
  DocumentRoot /opt/librenms/html/
  ServerName  librenms.example.com
  CustomLog /opt/librenms/logs/access_log combined
  ErrorLog /opt/librenms/logs/error_log
  AllowEncodedSlashes On
  &lt;Directory &quot;/opt/librenms/html/&quot;&gt;
    AllowOverride All
    Options FollowSymLinks MultiViews
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre>

<p>If you are running Apache 2.2.18 or higher:</p>
<pre><code class="apache">&lt;VirtualHost *:80&gt;
  DocumentRoot /opt/librenms/html/
  ServerName  librenms.example.com
  CustomLog /opt/librenms/logs/access_log combined
  ErrorLog /opt/librenms/logs/error_log
  AllowEncodedSlashes NoDecode
  &lt;Directory &quot;/opt/librenms/html/&quot;&gt;
    AllowOverride All
    Options FollowSymLinks MultiViews
    Require all granted
  &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre>

<p>If the file <code>/etc/httpd/conf.d/welcome.conf</code> exists, you will want to remove that as well unless you're familiar with <a href="https://httpd.apache.org/docs/2.2/vhosts/name-based.html">Name-based Virtual Hosts</a>.</p>
<pre><code class="bash">rn /etc/httpd/conf.d/welcome.conf /etc/httpd/conf.d/welcome.conf.bak
</code></pre>

<h3 id="using-nginx-and-php-fpm">Using Nginx and PHP-FPM</h3>
<p>If you choose to run Nginx, you will need to install necessary extra software and let it start on system boot.</p>
<pre><code class="bash">    yum install nginx php-fpm
    chkconfig nginx on
    chkconfig php-fpm on
</code></pre>

<p>Modify permissions and configuration for <code>php-fpm</code> to use nginx credentials.</p>
<pre><code>mkdir /var/lib/php/session
chown root:nginx /var/lib/php -R
vim /etc/php-fpm.d/www.conf      # At line #12: Change `listen` to `/var/run/php5-fpm.sock`
                                # At line #39-41: Change the `user` and `group` to `nginx`
</code></pre>
<p>Add configuration for <code>nginx</code> at <code>/etc/nginx/conf.d/librenms.conf</code> with the following content:</p>
<pre><code class="nginx">server {
 listen      80;
 server_name librenms.example.com;
 root        /opt/librenms/html;
 index       index.php;
 access_log  /opt/librenms/logs/access_log;
 error_log   /opt/librenms/logs/error_log;
 location / {
  try_files $uri $uri/ @librenms;
 }
 location ~ \.php {
  fastcgi_param PATH_INFO $fastcgi_path_info;
  include fastcgi.conf;
  fastcgi_split_path_info ^(.+\.php)(/.+)$;
  fastcgi_pass unix:/var/run/php5-fpm.sock;
 }
 location ~ /\.ht {
  deny all;
 }
 location @librenms {
  rewrite api/v0(.*)$ /api_v0.php/$1 last;
  rewrite ^(.+)$ /index.php/$1 last;
 }
}
</code></pre>

<h3 id="cloning">Cloning</h3>
<p>You can clone the repository via HTTPS or SSH.  In either case, you need to ensure the appropriate port (443 for HTTPS, 22 for SSH) is open in the outbound direction for your server.</p>
<pre><code class="bash">    cd /opt
    git clone https://github.com/librenms/librenms.git librenms
    cd /opt/librenms
</code></pre>

<p>NOTE: The recommended method of cloning a git repository is HTTPS.  If you would like to clone via SSH instead, use the command <code>git clone git@github.com:librenms/librenms.git librenms</code> instead.</p>
<h3 id="prepare-the-web-interface">Prepare the Web Interface</h3>
<p>To prepare the web interface, you'll need to create and chown a directory as well as create an Apache vhost.</p>
<p>First, create and chown the <code>rrd</code> directory and create the <code>logs</code> directory</p>
<pre><code class="bash">    mkdir rrd logs
    chown -R librenms:librenms /opt/librenms
    chmod 775 rrd
</code></pre>

<p>If you're planing on running rrdcached, make sure that the path is also chmod'ed to 775 and chown'ed to librenms:librenms.</p>
<p><strong>SELinux</strong></p>
<blockquote>
<p>if you're using SELinux you need to allow web server user to write into logs directory.
semanage tool is a part of policycoreutils-python, so if don't have it, you can install it
<strong>Please note that running LibreNMS with SELinux is still experimental and we cannot guarantee that everything will be working fine for now.</strong></p>
</blockquote>
<pre><code class="bash">    yum install policycoreutils-python
</code></pre>

<pre><code class="bash">    semanage fcontext -a -t httpd_sys_content_t '/opt/librenms/logs(/.*)?'
    semanage fcontext -a -t httpd_sys_rw_content_t '/opt/librenms/logs(/.*)?'
    restorecon -RFvv /opt/librenms/logs/
</code></pre>

<p>Set selinux to allow httpd to sendmail</p>
<pre><code class="bash">    setsebool -P httpd_can_sendmail=1
</code></pre>

<h3 id="start-the-web-server">Start the web-server:</h3>
<pre><code># For HTTPd (Apache):
service httpd restart

# For Nginx:
service nginx restart
</code></pre>
<h3 id="web-installer">Web Installer</h3>
<p>At this stage you can launch the web installer by going to <code>http://IP/install.php</code> and follow the on-screen instructions. Alternatively if you want to continue the setup manually then perform the manual install steps. If you cannot reach the installer, stop here and solve that problem before proceeding. Afterwards, Add the following line to the end of <code>config.php</code>:</p>
<pre><code>$config['fping'] = "/usr/sbin/fping";
</code></pre>
<h3 id="manual-install">Manual Install</h3>
<p>You may skip this section if the web installer succeeded.</p>
<pre><code class="bash">    cp config.php.default config.php
    vi config.php
</code></pre>

<p>Change the values to the right of the equal sign for lines beginning with <code>$config[db_]</code> to match your database information as previously configured.</p>
<p>Change the value of <code>$config['snmp']['community']</code> from <code>public</code> to whatever your default read-only SNMP community is.  If you have multiple existing communities in your environment, set it to the most common.</p>
<p>Add the following line to the end of <code>config.php</code>:</p>
<pre><code>$config['fping'] = "/usr/sbin/fping";
</code></pre>
<p>Important: Be sure you have no characters (including whitespace like: newlines, spaces, tabs, etc) outside of the <code>&lt;?php?&gt;</code> blocks. Your graphs will break otherwise and there will be no error messages to indicate otherwise!</p>
<p><strong>Initialize the database</strong></p>
<p>Initiate the follow database with the following command:</p>
<pre><code>php build-base.php
</code></pre>
<p><strong>Create admin user</strong></p>
<p>Create the admin user - priv should be 10</p>
<pre><code>php adduser.php &lt;name&gt; &lt;pass&gt; 10 &lt;email&gt;
</code></pre>
<p>Substitute your desired username, password and email address--and leave the angled brackets off.</p>
<h3 id="validate-your-install">Validate your install</h3>
<p>After performing the manual install or web install, be sure to run validate.php as root in the librenms directory:</p>
<pre><code>php validate.php
</code></pre>
<p>This will check your install to verify it is set up correctly.</p>
<h3 id="add-localhost">Add localhost</h3>
<pre><code>php addhost.php localhost public v2c
</code></pre>
<p>Replace <code>public</code> to match what you set in <code>/etc/snmp/snmpd.conf</code>.  This command also assumes you are using SNMP v2c.  If you're using v3, there are additional steps (NOTE: instructions for SNMPv3 to come).</p>
<p>Discover localhost:</p>
<pre><code>php discovery.php -h all
</code></pre>
<h3 id="create-cronjob">Create cronjob</h3>
<p>The polling method used by LibreNMS is <code>poller-wrapper.py</code>, which was placed in the public domain by its author.  By default, the LibreNMS cronjob runs <code>poller-wrapper.py</code> with 16 threads.  The current LibreNMS recommendation is to use 4 threads per core.  The default if no thread count is <code>16 threads</code>.</p>
<p>If the thread count needs to be changed, you can do so by editing the cron file (<code>/etc/cron.d/librenms</code>).
 Just add a number after <code>poller-wrapper.py</code>, as in the below example:</p>
<pre><code>/opt/librenms/poller-wrapper.py 12 &gt;&gt; /dev/null 2&gt;&amp;1
</code></pre>
<p>Create the cronjob</p>
<pre><code>cp librenms.nonroot.cron /etc/cron.d/librenms
</code></pre>
<h3 id="copy-logrotate-config">Copy logrotate config</h3>
<p>LibreNMS keeps logs in <code>/opt/librenms/logs</code>. Over time these can become large and be rotated out.  To rotate out the old logs you can use the provided logrotate config file:</p>
<pre><code>cp misc/librenms.logrotate /etc/logrotate.d/librenms
</code></pre>
<h3 id="daily-updates">Daily Updates</h3>
<p>LibreNMS performs daily updates by default.  At 00:15 system time every day, a <code>git pull --no-edit --quiet</code> is performed.  You can override this default by editing
your <code>config.php</code> file.  Remove the comment (the <code>#</code> mark) on the line:</p>
<pre><code>#$config['update'] = 0;
</code></pre>
<p>so that it looks like this:</p>
<pre><code>$config['update'] = 0;
</code></pre>
<h3 id="install-complete">Install complete</h3>
<p>Please allow for 2-3 runs of the poller-wrapper for data to start appearing in the WebUI.
If you don't see data after this, please refer to the <a href="http://docs.librenms.org/Support/FAQ/">FAQ</a> for assistance.</p>
<p>That's it!  You now should be able to log in to http://librenms.example.com/.  Please note that we have not covered HTTPS setup in this example, so your LibreNMS install is not secure by default.  Please do not expose it to the public Internet unless you have configured HTTPS and taken appropriate web server hardening steps.</p>
<p>It would be great if you would consider opting into the stats system we have, please see <a href="http://docs.librenms.org/General/Callback-Stats-and-Privacy/">this page</a> on what it is and how to enable it.</p>

  <br>
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="Installation/Installation-(Debian-Ubuntu)/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="Installation/Installation-(Debian-Ubuntu)/" class="btn btn-xs btn-link">
        Installation (Debian Ubuntu)
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="Installation/Installation-Ubuntu-1604-Apache/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="Installation/Installation-Ubuntu-1604-Apache/" class="btn btn-xs btn-link">
        Ubuntu 16.04 (Apache)
      </a>
    </div>
    
  </div>


    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>